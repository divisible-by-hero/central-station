{% extends 'base.html' %}

{% block extra_js %}
<link href="{{ STATIC_URL }}css/smoothness/jquery-ui-1.8.23.custom.css" rel="stylesheet" type="text/css"/>
<script src="{{ STATIC_URL }}js/jquery-1.8.0.min.js"></script>
<script src="{{ STATIC_URL }}js/jquery-ui-1.8.23.custom.min.js"></script>
<script type="text/javascript">
    var csrf_token = "{{ csrf_token }}";
</script>
<script>
$(document).ready(function(){
    $( ".cs-board-column" ).sortable({
        connectWith: '.cs-board-column',
        receive: function(event, ui) {
            //console.log(ui.item)
            var id = ui.item.attr('data-id');
            var status = ui.item.parent().attr('data-column');
            updateStoryStatus(id, status)

        }
    });
});

function updateStoryStatus(story_id, story_status){
	$.ajax({
		type: "POST",
		url: "/sprints/update/story-status/",
		dataType: 'json',
		data: "csrfmiddlewaretoken=" + csrf_token + "&story_id=" + story_id + "&story_status=" + story_status,
		success: function(data){
		    if ( data.success ){
		        //do something
		    }
		    else {
		        //do something else
		    }
		},
	 });
}


</script>
{% endblock %}


{% block main_content %}

    <style>
        ul.cs-board-column { margin: 0; padding:0; width: 24%; height: 500px; float: left; border: 1px solid #333333; }
        ul.cs-board-column li { margin: 10px; padding: 10px; list-style-type: none; border: 1px solid #cccccc; }
        
        .cs-story-card { clear: both;}
        .cs-story-card-points { margin: 0; padding: 0; float: left; }
        .cs-story-card-title { margin: 0 0 0 30px; }
        
        .clear { clear: both;}
        
    </style>

    <h1>{{ sprint.name }}</h1>
    <div id='cs-board'>
        

        {% for column in sorted_stories %}
        <ul id='cs-board-{{ column.id }}' class='cs-board-column' data-column='{{ column.id }}'>
            {% for story in column.stories %}
              <li id='cs-story-card-{{ story.id }}' class='cs-story-card' data-id='{{ story.id }}'>
                  <h1 class='cs-story-card-points'>{{ story.points }}</h1>
                  <p class='cs-story-card-title'>{{ story.title }}</p>
                  <div class='clear'></div>
              </li>
            {% endfor %}
        </ul>
        {% endfor %}

        
    </div>

    <div class='clear'></div>    


{% endblock %}
